// Code generated by https://github.com/zhufuyi/sponge

package service

import (
	"context"
	"encoding/json"
	"fmt"
	"testing"
	"time"

	creationV1 "creation/api/creation/v1"
	"creation/configs"
	"creation/internal/config"

	"github.com/zhufuyi/sponge/pkg/grpc/benchmark"
)

// Test each method of postService via the rpc client
func Test_service_postService_methods(t *testing.T) {
	conn := getRPCClientConnForTest()
	cli := creationV1.NewPostServiceClient(conn)
	ctx, _ := context.WithTimeout(context.Background(), time.Second*5)

	tests := []struct {
		name    string
		fn      func() (interface{}, error)
		wantErr bool
	}{
		{
			name: "Create",
			fn: func() (interface{}, error) {
				// todo type in the parameters to test
				req := &creationV1.CreatePostRequest{
					UserId: 0, 
					Title: "", 
					Text: "", 
					PicKeys: "", 
					VideoKey: "", 
					VideoDuration: 0, 
					CoverKey: "", 
					CoverWidth: 0, 
					CoverHeight: 0, 
					Longitude: 0.0, 
					Latitude: 0.0, 
					Position: "", 
				}
				return cli.Create(ctx, req)
			},
			wantErr: false,
		},
		{
			name: "UpdateContent",
			fn: func() (interface{}, error) {
				// todo type in the parameters to test
				req := &creationV1.UpdatePostContentRequest{
					Id: 0, 
					Title: "", 
					Text: "", 
					PicKeys: "", 
					VideoKey: "", 
					VideoDuration: 0, 
					CoverKey: "", 
					CoverWidth: 0, 
					CoverHeight: 0, 
					Longitude: 0.0, 
					Latitude: 0.0, 
					Position: "", 
				}
				return cli.UpdateContent(ctx, req)
			},
			wantErr: false,
		},
		{
			name: "Delete",
			fn: func() (interface{}, error) {
				// todo type in the parameters to test
				req := &creationV1.DeletePostRequest{
					Id: 0, 
					UserId: 0, 
					DelFlag: 0, 
				}
				return cli.Delete(ctx, req)
			},
			wantErr: false,
		},
		{
			name: "GetByID",
			fn: func() (interface{}, error) {
				// todo type in the parameters to test
				req := &creationV1.GetPostByIDRequest{
					Id: 0, 
				}
				return cli.GetByID(ctx, req)
			},
			wantErr: false,
		},
		{
			name: "ListByIDs",
			fn: func() (interface{}, error) {
				// todo type in the parameters to test
				req := &creationV1.ListPostByIDsRequest{
					Ids: nil, 
				}
				return cli.ListByIDs(ctx, req)
			},
			wantErr: false,
		},
		{
			name: "ListByUserID",
			fn: func() (interface{}, error) {
				// todo type in the parameters to test
				req := &creationV1.ListPostByUserIDRequest{
					UserId: 0, 
					Page: 0, 
					Limit: 0, 
				}
				return cli.ListByUserID(ctx, req)
			},
			wantErr: false,
		},
		{
			name: "ListLatest",
			fn: func() (interface{}, error) {
				// todo type in the parameters to test
				req := &creationV1.ListPostLatestRequest{
					Page: 0, 
					Limit: 0, 
				}
				return cli.ListLatest(ctx, req)
			},
			wantErr: false,
		},
		{
			name: "ListHot",
			fn: func() (interface{}, error) {
				// todo type in the parameters to test
				req := &creationV1.ListPostHotRequest{
					Page: 0, 
					Limit: 0, 
				}
				return cli.ListHot(ctx, req)
			},
			wantErr: false,
		},
		{
			name: "IncrViewCount",
			fn: func() (interface{}, error) {
				// todo type in the parameters to test
				req := &creationV1.IncrPostViewCountRequest{
					Id: 0, 
					UserId: 0, 
				}
				return cli.IncrViewCount(ctx, req)
			},
			wantErr: false,
		},
		{
			name: "IncrShareCount",
			fn: func() (interface{}, error) {
				// todo type in the parameters to test
				req := &creationV1.IncrPostShareCountRequest{
					Id: 0, 
					UserId: 0, 
				}
				return cli.IncrShareCount(ctx, req)
			},
			wantErr: false,
		},
	}

	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			got, err := tt.fn()
			if (err != nil) != tt.wantErr {
				t.Errorf("test '%s' error = %v, wantErr %v", tt.name, err, tt.wantErr)
				return
			}
			data, _ := json.MarshalIndent(got, "", "    ")
			fmt.Println(string(data))
		})
	}
}

// Perform a stress test on postService's method and 
// copy the press test report to your browser when you are finished.
func Test_service_postService_benchmark(t *testing.T) {
	err := config.Init(configs.Path("creation.yml"))
	if err != nil {
		panic(err)
	}
	host := fmt.Sprintf("127.0.0.1:%d", config.Get().Grpc.Port)
	protoFile := configs.Path("../api/creation/v1/post.proto")
	// If third-party dependencies are missing during the press test,
	// copy them to the project's third_party directory.
	importPaths := []string{
		configs.Path("../third_party"), // third_party directory
		configs.Path(".."),             // Previous level of third_party
	}

	tests := []struct {
		name    string
		fn      func() error
		wantErr bool
	}{
		{
			name: "Create",
			fn: func() error {
				// todo type in the parameters to test
				message := &creationV1.CreatePostRequest{
					UserId: 0, 
					Title: "", 
					Text: "", 
					PicKeys: "", 
					VideoKey: "", 
					VideoDuration: 0, 
					CoverKey: "", 
					CoverWidth: 0, 
					CoverHeight: 0, 
					Longitude: 0.0, 
					Latitude: 0.0, 
					Position: "", 
				}
				var total uint = 1000 // total number of requests
				b, err := benchmark.New(host, protoFile, "Create", message, total, importPaths...)
				if err != nil {
					return err
				}
				return b.Run()
			},
			wantErr: false,
		},
		{
			name: "UpdateContent",
			fn: func() error {
				// todo type in the parameters to test
				message := &creationV1.UpdatePostContentRequest{
					Id: 0, 
					Title: "", 
					Text: "", 
					PicKeys: "", 
					VideoKey: "", 
					VideoDuration: 0, 
					CoverKey: "", 
					CoverWidth: 0, 
					CoverHeight: 0, 
					Longitude: 0.0, 
					Latitude: 0.0, 
					Position: "", 
				}
				var total uint = 1000 // total number of requests
				b, err := benchmark.New(host, protoFile, "UpdateContent", message, total, importPaths...)
				if err != nil {
					return err
				}
				return b.Run()
			},
			wantErr: false,
		},
		{
			name: "Delete",
			fn: func() error {
				// todo type in the parameters to test
				message := &creationV1.DeletePostRequest{
					Id: 0, 
					UserId: 0, 
					DelFlag: 0, 
				}
				var total uint = 1000 // total number of requests
				b, err := benchmark.New(host, protoFile, "Delete", message, total, importPaths...)
				if err != nil {
					return err
				}
				return b.Run()
			},
			wantErr: false,
		},
		{
			name: "GetByID",
			fn: func() error {
				// todo type in the parameters to test
				message := &creationV1.GetPostByIDRequest{
					Id: 0, 
				}
				var total uint = 1000 // total number of requests
				b, err := benchmark.New(host, protoFile, "GetByID", message, total, importPaths...)
				if err != nil {
					return err
				}
				return b.Run()
			},
			wantErr: false,
		},
		{
			name: "ListByIDs",
			fn: func() error {
				// todo type in the parameters to test
				message := &creationV1.ListPostByIDsRequest{
					Ids: nil, 
				}
				var total uint = 1000 // total number of requests
				b, err := benchmark.New(host, protoFile, "ListByIDs", message, total, importPaths...)
				if err != nil {
					return err
				}
				return b.Run()
			},
			wantErr: false,
		},
		{
			name: "ListByUserID",
			fn: func() error {
				// todo type in the parameters to test
				message := &creationV1.ListPostByUserIDRequest{
					UserId: 0, 
					Page: 0, 
					Limit: 0, 
				}
				var total uint = 1000 // total number of requests
				b, err := benchmark.New(host, protoFile, "ListByUserID", message, total, importPaths...)
				if err != nil {
					return err
				}
				return b.Run()
			},
			wantErr: false,
		},
		{
			name: "ListLatest",
			fn: func() error {
				// todo type in the parameters to test
				message := &creationV1.ListPostLatestRequest{
					Page: 0, 
					Limit: 0, 
				}
				var total uint = 1000 // total number of requests
				b, err := benchmark.New(host, protoFile, "ListLatest", message, total, importPaths...)
				if err != nil {
					return err
				}
				return b.Run()
			},
			wantErr: false,
		},
		{
			name: "ListHot",
			fn: func() error {
				// todo type in the parameters to test
				message := &creationV1.ListPostHotRequest{
					Page: 0, 
					Limit: 0, 
				}
				var total uint = 1000 // total number of requests
				b, err := benchmark.New(host, protoFile, "ListHot", message, total, importPaths...)
				if err != nil {
					return err
				}
				return b.Run()
			},
			wantErr: false,
		},
		{
			name: "IncrViewCount",
			fn: func() error {
				// todo type in the parameters to test
				message := &creationV1.IncrPostViewCountRequest{
					Id: 0, 
					UserId: 0, 
				}
				var total uint = 1000 // total number of requests
				b, err := benchmark.New(host, protoFile, "IncrViewCount", message, total, importPaths...)
				if err != nil {
					return err
				}
				return b.Run()
			},
			wantErr: false,
		},
		{
			name: "IncrShareCount",
			fn: func() error {
				// todo type in the parameters to test
				message := &creationV1.IncrPostShareCountRequest{
					Id: 0, 
					UserId: 0, 
				}
				var total uint = 1000 // total number of requests
				b, err := benchmark.New(host, protoFile, "IncrShareCount", message, total, importPaths...)
				if err != nil {
					return err
				}
				return b.Run()
			},
			wantErr: false,
		},
	}

	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			err := tt.fn()
			if (err != nil) != tt.wantErr {
				t.Errorf("test '%s' error = %v, wantErr %v", tt.name, err, tt.wantErr)
				return
			}
		})
	}
}
